

# خطة تنفيذ كيس "لغز محل أبو سعيد" - النسخة النهائية

---

## 1. النهاية الكاملة (مرحلتين)

النهاية هتكون على **مرحلتين** زي ما طلبت:

### المرحلة 1: حوار مع أبو سعيد (EnhancedDialogue)
بعد ما اللاعب يختار الفرضية النهائية ويضغط "قدم التقرير"، يروح مكتب أبو سعيد ويبدأ حوار:
- المحقق: "بعد تحليل كل الأدلة والبيانات، أنا توصلت للسبب..."
- المحقق: يعرض الفرضية اللي اختارها
- أبو سعيد: يرد حسب النتيجة (4 ردود مختلفة)

### المرحلة 2: شاشة النتيجة الكاملة (ResultScreen)
بعد الحوار مباشرة، تظهر شاشة النتيجة الكاملة فيها:
- العنوان الكبير (تحليل ممتاز / جزئي / خاطئ / فرضية مفقودة) مع أيقونة وألوان
- النتائج والعواقب (consequences) - إيه اللي هيحصل بناء على تحليلك
- النقاط النهائية + الرتبة (محقق بيانات أسطوري / خبير / متقدم / مبتدئ)
- إحصائيات: أدلة محفوظة / فرضيات مختارة / مقابلات مكتملة / هل H3 كانت ضمن الاختيارات
- الفرضية الصحيحة + شرح ليه (يظهر بعد ما يخلص - كدرس تعليمي)
- أزرار: العب تاني / القائمة الرئيسية

---

## 2. الأدلة - واقعية وبسيطة

كل دليل هيكون ليه **شكل واقعي** مناسب:

| الدليل | الشكل في الـ UI |
|--------|----------------|
| E1: تقرير المخزون vs الفواتير | **جدول بسيط** فيه عمودين: "قطع خرجت من المخزون" و"قطع مسجلة في فواتير" - الفرق واضح |
| E2: تقرير الكاميرات | **تقرير أمني** فيه ملخص: "عدد الأكياس الخارجة: 45 - عدد الفواتير المسجلة: 28" |
| E3: سجل نظام الكاشير | **شاشة نظام** فيها: "الحالة: يعمل بشكل طبيعي - آخر عطل: لا يوجد - رسائل خطأ: 0" |
| E4: بيانات الموسم الماضي | **مقارنة بسيطة**: "نفس الفترة السنة اللي فاتت: المبيعات 120,000 ر.س - هذا الأسبوع: 78,000 ر.س" |
| E5: تقييمات العملاء | **بطاقات تقييم**: 4-5 تعليقات إيجابية من زباين ("البضاعة حلوة"، "الأسعار معقولة") |
| E6: بروشور المنافس | **صورة بروشور**: "افتتاح محل كيدز فاشن - متخصصون في ملابس الأطفال فقط" |
| E7: ورقة ملاحظات قديمة | **ورقة مكتوبة بخط يد**: "لازم نراجع أسعار الموردين الشهر الجاي - أبو سعيد" (تاريخ قديم) |

---

## 3. المصفوفة التفاعلية (ACH Matrix) - UX كامل

### كيف اللاعب هيملأ المصفوفة:

المصفوفة هتكون **grid تفاعلي**:
- **الأعمدة** = الفرضيات الأربعة المختارة (مع ألوان مميزة)
- **الصفوف** = الأدلة المحفوظة في الدفتر
- **كل خلية** = لما اللاعب يضغط عليها، تظهر **4 أزرار ملونة** (dropdown أو popup):

| الزر | اللون | المعنى | الوصف للاعب |
|------|-------|--------|------------|
| متسق جدا | **أخضر غامق** مع حدود | لو الفرضية دي صح، الدليل ده متوقع جدا | "الدليل ده بيدعم الفرضية بقوة" |
| متسق | **أخضر فاتح** | لو الفرضية دي صح، الدليل ده ممكن | "الدليل ده مش بينفي الفرضية" |
| غير متسق | **أحمر فاتح** | لو الفرضية دي صح، الدليل ده غريب | "الدليل ده بيشكك في الفرضية" |
| يناقض | **أحمر غامق** مع حدود | لو الفرضية دي صح، الدليل ده مستحيل | "الدليل ده بينفي الفرضية تماما" |

### الـ UX التفاعلي:
- كل خلية فاضية في الأول (رمادي فاتح مع "؟")
- لما يضغط على خلية، تظهر **4 أزرار ملونة** كـ popover صغير
- لما يختار، الخلية تتلون بالون المناسب مع أيقونة صغيرة
- **ملخص تلقائي** تحت كل عمود (فرضية): عدد الأخضر وعدد الأحمر
- الفرضية اللي عندها **أقل أحمر** (أو صفر أحمر) تتميز بإطار ذهبي
- زر "اختر هذه الفرضية كإجابة نهائية" تحت المصفوفة

### مثال مرئي للمصفوفة:

```text
              |  H1 حركة قلت  |  H3 تسجيل ناقص  |  H5 بضاعة  |  H7 نظام  |
عداد الباب    |   [أحمر غامق]  |   [أخضر فاتح]    | [أخضر فاتح] | [أخضر فاتح]|
تقرير المخزون |   [أخضر فاتح]  |   [أخضر فاتح]    | [أخضر فاتح] | [أخضر فاتح]|
سجل النظام    |   [أخضر فاتح]  |   [أخضر فاتح]    | [أخضر فاتح] | [أحمر غامق]|
---------------------------------------------------------------------------
المجموع ضد:   |      1          |       0           |     0       |     1      |
```

---

## 4. هيكل الغرف (5 غرف) - بدون تغيير

1. **مكتب أبو سعيد**: السياق + تقديم التقرير النهائي
2. **غرفة الأدلة**: 7 أدلة مادية واقعية
3. **غرفة الاجتماعات**: 3 شخصيات x 2 سؤال = حوار EnhancedDialogue
4. **غرفة البيانات**: 3 charts + جدول (داشبورد)
5. **غرفة التحليل**: دفتر الملاحظات + الفرضيات + المصفوفة

---

## 5. التفاصيل التقنية - الملفات المتأثرة

| # | الملف | التغيير |
|---|-------|---------|
| 1 | `src/data/case1.ts` | إعادة كتابة كاملة: 8 فرضيات، 16 دليل (بأشكال واقعية)، 4 شخصيات، بيانات charts، 4 نهايات مع حوارات ونتائج وعواقب |
| 2 | `src/contexts/GameContext.tsx` | إعادة بناء: حذف time/trust/pins/insights. إضافة notebook[], selectedHypotheses[], achMatrix (Record of Record), finalHypothesis, completedInterviews[], viewedEvidence[]. إضافة getEnding() جديدة بـ4 سيناريوهات + حساب نقاط جديد |
| 3 | `src/components/game/AnimatedCharacter.tsx` | إضافة character IDs: abuSaeed (= detective img), khaled (= ahmed img), noura (= sara img), umFahd (= karim img) |
| 4 | `src/components/game/EnhancedDialogue.tsx` | إضافة characters جديدة + prop اختياري onSaveNote مع زر "احفظ في الدفتر" |
| 5 | `src/pages/Index.tsx` | إضافة شاشة "dashboard" + تحديث Screen type |
| 6 | `src/components/game/screens/IntroScreen.tsx` | عنوان ووصف الكيس الجديدة |
| 7 | `src/components/game/screens/OnboardingScreen.tsx` | قواعد مبسطة + شرح 5 غرف + دفتر + فرضيات + مصفوفة |
| 8 | `src/components/game/screens/OfficeScreen.tsx` | إعادة بناء: مكتب أبو سعيد + حوار افتتاحي + hotspots + تقديم التقرير النهائي (حوار EnhancedDialogue مع رد أبو سعيد) |
| 9 | `src/components/game/screens/EvidenceScreen.tsx` | 7 أدلة جديدة بأشكال واقعية + ترتيب مخلوط + زر "احفظ في الدفتر" |
| 10 | `src/components/game/screens/InterrogationScreen.tsx` | إعادة بناء: 3 شخصيات x حوار EnhancedDialogue (4 خطوات) + زر حفظ بعد كل رد |
| 11 | `src/components/game/screens/DashboardScreen.tsx` | **ملف جديد**: 3 charts (recharts) + جدول + زر حفظ ملاحظة |
| 12 | `src/components/game/screens/AnalysisScreen.tsx` | إعادة بناء: 3 tabs (دفتر + فرضيات + مصفوفة ACH تفاعلية بالألوان) |
| 13 | `src/components/game/screens/ResultScreen.tsx` | تحديث: 4 نهايات + إحصائيات + رتب + الفرضية الصحيحة كدرس + أزرار إعادة |

### ترتيب التنفيذ:
1. `case1.ts` (الأساس)
2. `GameContext.tsx` (الـ State)
3. `AnimatedCharacter.tsx` + `EnhancedDialogue.tsx` (الشخصيات)
4. `IntroScreen.tsx` + `OnboardingScreen.tsx`
5. `OfficeScreen.tsx`
6. `EvidenceScreen.tsx`
7. `InterrogationScreen.tsx`
8. `DashboardScreen.tsx` (جديد)
9. `AnalysisScreen.tsx` (المصفوفة التفاعلية)
10. `ResultScreen.tsx` (النهاية الكاملة)
11. `Index.tsx`

